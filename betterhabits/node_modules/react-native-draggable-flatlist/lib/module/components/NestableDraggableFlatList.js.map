{"version":3,"names":["React","useRef","useState","findNodeHandle","LogBox","useDerivedValue","useSharedValue","DraggableFlatList","useSafeNestableScrollContainerContext","useNestedAutoScroll","useStableCallback","NestableDraggableFlatListInner","props","ref","hasSuppressedWarnings","current","ignoreLogs","console","reportErrorsAsExceptions","scrollableRef","outerScrollOffset","setOuterScrollEnabled","listVerticalOffset","animVals","setAnimVals","defaultHoverOffset","listHoverOffset","setListHoverOffset","hoverOffset","value","onListContainerLayout","containerRef","nodeHandle","onSuccess","_x","y","onFail","log","measureLayout","onDragBegin","params","onDragEnd","onAnimValInit","activationDistance","NestableDraggableFlatList","forwardRef"],"sources":["NestableDraggableFlatList.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\nimport { findNodeHandle, LogBox } from \"react-native\";\nimport Animated, {\n  useDerivedValue,\n  useSharedValue,\n} from \"react-native-reanimated\";\nimport { DraggableFlatListProps } from \"../types\";\nimport DraggableFlatList from \"../components/DraggableFlatList\";\nimport { useSafeNestableScrollContainerContext } from \"../context/nestableScrollContainerContext\";\nimport { useNestedAutoScroll } from \"../hooks/useNestedAutoScroll\";\nimport { typedMemo } from \"../utils\";\nimport { useStableCallback } from \"../hooks/useStableCallback\";\nimport { FlatList } from \"react-native-gesture-handler\";\n\nfunction NestableDraggableFlatListInner<T>(\n  props: DraggableFlatListProps<T>,\n  ref?: React.ForwardedRef<FlatList<T>>\n) {\n  const hasSuppressedWarnings = useRef(false);\n\n  if (!hasSuppressedWarnings.current) {\n    LogBox.ignoreLogs([\n      \"VirtualizedLists should never be nested inside plain ScrollViews with the same orientation because it can break windowing\",\n    ]); // Ignore log notification by message\n    //@ts-ignore\n    console.reportErrorsAsExceptions = false;\n    hasSuppressedWarnings.current = true;\n  }\n\n  const {\n    scrollableRef,\n    outerScrollOffset,\n    setOuterScrollEnabled,\n  } = useSafeNestableScrollContainerContext();\n\n  const listVerticalOffset = useSharedValue(0);\n  const [animVals, setAnimVals] = useState({});\n  const defaultHoverOffset = useSharedValue(0);\n  const [listHoverOffset, setListHoverOffset] = useState(defaultHoverOffset);\n\n  const hoverOffset = useDerivedValue(() => {\n    return listHoverOffset.value + listVerticalOffset.value;\n  }, [listHoverOffset]);\n\n  useNestedAutoScroll({\n    ...animVals,\n    hoverOffset,\n  });\n\n  const onListContainerLayout = useStableCallback(async ({ containerRef }) => {\n    const nodeHandle = findNodeHandle(scrollableRef.current);\n\n    const onSuccess = (_x: number, y: number) => {\n      listVerticalOffset.value = y;\n    };\n    const onFail = () => {\n      console.log(\"## nested draggable list measure fail\");\n    };\n    //@ts-ignore\n    containerRef.current.measureLayout(nodeHandle, onSuccess, onFail);\n  });\n\n  const onDragBegin: DraggableFlatListProps<T>[\"onDragBegin\"] = useStableCallback(\n    (params) => {\n      setOuterScrollEnabled(false);\n      props.onDragBegin?.(params);\n    }\n  );\n\n  const onDragEnd: DraggableFlatListProps<T>[\"onDragEnd\"] = useStableCallback(\n    (params) => {\n      setOuterScrollEnabled(true);\n      props.onDragEnd?.(params);\n    }\n  );\n\n  const onAnimValInit: DraggableFlatListProps<T>[\"onAnimValInit\"] = useStableCallback(\n    (params) => {\n      setListHoverOffset(params.hoverOffset);\n      setAnimVals({\n        ...params,\n        hoverOffset,\n      });\n      props.onAnimValInit?.(params);\n    }\n  );\n\n  return (\n    <DraggableFlatList\n      ref={ref}\n      onContainerLayout={onListContainerLayout}\n      activationDistance={props.activationDistance || 20}\n      scrollEnabled={false}\n      {...props}\n      outerScrollOffset={outerScrollOffset}\n      onDragBegin={onDragBegin}\n      onDragEnd={onDragEnd}\n      onAnimValInit={onAnimValInit}\n    />\n  );\n}\n\n// Generic forwarded ref type assertion taken from:\n// https://fettblog.eu/typescript-react-generic-forward-refs/#option-1%3A-type-assertion\nexport const NestableDraggableFlatList = React.forwardRef(\n  NestableDraggableFlatListInner\n) as <T>(\n  props: DraggableFlatListProps<T> & { ref?: React.ForwardedRef<FlatList<T>> }\n) => ReturnType<typeof NestableDraggableFlatListInner>;\n"],"mappings":"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"}