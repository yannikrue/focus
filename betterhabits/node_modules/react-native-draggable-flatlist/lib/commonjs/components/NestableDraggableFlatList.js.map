{"version":3,"names":["NestableDraggableFlatListInner","props","ref","hasSuppressedWarnings","useRef","current","LogBox","ignoreLogs","console","reportErrorsAsExceptions","useSafeNestableScrollContainerContext","scrollableRef","outerScrollOffset","setOuterScrollEnabled","listVerticalOffset","useSharedValue","useState","animVals","setAnimVals","defaultHoverOffset","listHoverOffset","setListHoverOffset","hoverOffset","useDerivedValue","value","useNestedAutoScroll","onListContainerLayout","useStableCallback","containerRef","nodeHandle","findNodeHandle","onSuccess","_x","y","onFail","log","measureLayout","onDragBegin","params","onDragEnd","onAnimValInit","activationDistance","NestableDraggableFlatList","React","forwardRef"],"sources":["NestableDraggableFlatList.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\nimport { findNodeHandle, LogBox } from \"react-native\";\nimport Animated, {\n  useDerivedValue,\n  useSharedValue,\n} from \"react-native-reanimated\";\nimport { DraggableFlatListProps } from \"../types\";\nimport DraggableFlatList from \"../components/DraggableFlatList\";\nimport { useSafeNestableScrollContainerContext } from \"../context/nestableScrollContainerContext\";\nimport { useNestedAutoScroll } from \"../hooks/useNestedAutoScroll\";\nimport { typedMemo } from \"../utils\";\nimport { useStableCallback } from \"../hooks/useStableCallback\";\nimport { FlatList } from \"react-native-gesture-handler\";\n\nfunction NestableDraggableFlatListInner<T>(\n  props: DraggableFlatListProps<T>,\n  ref?: React.ForwardedRef<FlatList<T>>\n) {\n  const hasSuppressedWarnings = useRef(false);\n\n  if (!hasSuppressedWarnings.current) {\n    LogBox.ignoreLogs([\n      \"VirtualizedLists should never be nested inside plain ScrollViews with the same orientation because it can break windowing\",\n    ]); // Ignore log notification by message\n    //@ts-ignore\n    console.reportErrorsAsExceptions = false;\n    hasSuppressedWarnings.current = true;\n  }\n\n  const {\n    scrollableRef,\n    outerScrollOffset,\n    setOuterScrollEnabled,\n  } = useSafeNestableScrollContainerContext();\n\n  const listVerticalOffset = useSharedValue(0);\n  const [animVals, setAnimVals] = useState({});\n  const defaultHoverOffset = useSharedValue(0);\n  const [listHoverOffset, setListHoverOffset] = useState(defaultHoverOffset);\n\n  const hoverOffset = useDerivedValue(() => {\n    return listHoverOffset.value + listVerticalOffset.value;\n  }, [listHoverOffset]);\n\n  useNestedAutoScroll({\n    ...animVals,\n    hoverOffset,\n  });\n\n  const onListContainerLayout = useStableCallback(async ({ containerRef }) => {\n    const nodeHandle = findNodeHandle(scrollableRef.current);\n\n    const onSuccess = (_x: number, y: number) => {\n      listVerticalOffset.value = y;\n    };\n    const onFail = () => {\n      console.log(\"## nested draggable list measure fail\");\n    };\n    //@ts-ignore\n    containerRef.current.measureLayout(nodeHandle, onSuccess, onFail);\n  });\n\n  const onDragBegin: DraggableFlatListProps<T>[\"onDragBegin\"] = useStableCallback(\n    (params) => {\n      setOuterScrollEnabled(false);\n      props.onDragBegin?.(params);\n    }\n  );\n\n  const onDragEnd: DraggableFlatListProps<T>[\"onDragEnd\"] = useStableCallback(\n    (params) => {\n      setOuterScrollEnabled(true);\n      props.onDragEnd?.(params);\n    }\n  );\n\n  const onAnimValInit: DraggableFlatListProps<T>[\"onAnimValInit\"] = useStableCallback(\n    (params) => {\n      setListHoverOffset(params.hoverOffset);\n      setAnimVals({\n        ...params,\n        hoverOffset,\n      });\n      props.onAnimValInit?.(params);\n    }\n  );\n\n  return (\n    <DraggableFlatList\n      ref={ref}\n      onContainerLayout={onListContainerLayout}\n      activationDistance={props.activationDistance || 20}\n      scrollEnabled={false}\n      {...props}\n      outerScrollOffset={outerScrollOffset}\n      onDragBegin={onDragBegin}\n      onDragEnd={onDragEnd}\n      onAnimValInit={onAnimValInit}\n    />\n  );\n}\n\n// Generic forwarded ref type assertion taken from:\n// https://fettblog.eu/typescript-react-generic-forward-refs/#option-1%3A-type-assertion\nexport const NestableDraggableFlatList = React.forwardRef(\n  NestableDraggableFlatListInner\n) as <T>(\n  props: DraggableFlatListProps<T> & { ref?: React.ForwardedRef<FlatList<T>> }\n) => ReturnType<typeof NestableDraggableFlatListInner>;\n"],"mappings":"mcAAA,qDACA,yCACA,8DAKA,0FACA,yFACA,iEAEA,6D,6nCAGA,QAASA,+BAAT,CACEC,KADF,CAEEC,GAFF,CAGE,CACA,GAAMC,sBAAqB,CAAG,GAAAC,aAAA,EAAO,KAAP,CAA9B,CAEA,GAAI,CAACD,qBAAqB,CAACE,OAA3B,CAAoC,CAClCC,mBAAA,CAAOC,UAAP,CAAkB,CAChB,2HADgB,CAAlB,EAIAC,OAAO,CAACC,wBAAR,CAAmC,KAAnC,CACAN,qBAAqB,CAACE,OAAtB,CAAgC,IAAhC,CACD,CAVD,0BAgBI,GAAAK,qEAAA,GAhBJ,CAaEC,aAbF,uBAaEA,aAbF,CAcEC,iBAdF,uBAcEA,iBAdF,CAeEC,qBAfF,uBAeEA,qBAfF,CAkBA,GAAMC,mBAAkB,CAAG,GAAAC,qCAAA,EAAe,CAAf,CAA3B,CAlBA,cAmBgC,GAAAC,eAAA,EAAS,EAAT,CAnBhC,qDAmBOC,QAnBP,eAmBiBC,WAnBjB,eAoBA,GAAMC,mBAAkB,CAAG,GAAAJ,qCAAA,EAAe,CAAf,CAA3B,CApBA,eAqB8C,GAAAC,eAAA,EAASG,kBAAT,CArB9C,sDAqBOC,eArBP,eAqBwBC,kBArBxB,eAuBA,GAAMC,YAAW,CAAG,GAAAC,sCAAA,iCAAsB,CACxC,MAAOH,gBAAe,CAACI,KAAhB,CAAwBV,kBAAkB,CAACU,KAAlD,CACD,CAFmB,8BAtCbJ,eAsCa,oBAtCWN,kBAsCX,uUAEjB,CAACM,eAAD,CAFiB,CAApB,CAIA,GAAAK,wCAAA,mBACKR,QADL,EAEEK,WAAW,CAAXA,WAFF,IAKA,GAAMI,sBAAqB,CAAG,GAAAC,oCAAA,sDAAkB,eAA4B,IAAnBC,aAAmB,MAAnBA,YAAmB,CAC1E,GAAMC,WAAU,CAAG,GAAAC,2BAAA,EAAenB,aAAa,CAACN,OAA7B,CAAnB,CAEA,GAAM0B,UAAS,CAAG,QAAZA,UAAY,CAACC,EAAD,CAAaC,CAAb,CAA2B,CAC3CnB,kBAAkB,CAACU,KAAnB,CAA2BS,CAA3B,CACD,CAFD,CAGA,GAAMC,OAAM,CAAG,QAATA,OAAS,EAAM,CACnB1B,OAAO,CAAC2B,GAAR,CAAY,uCAAZ,EACD,CAFD,CAIAP,YAAY,CAACvB,OAAb,CAAqB+B,aAArB,CAAmCP,UAAnC,CAA+CE,SAA/C,CAA0DG,MAA1D,EACD,CAX6B,gEAA9B,CAaA,GAAMG,YAAqD,CAAG,GAAAV,oCAAA,EAC5D,SAACW,MAAD,CAAY,CACVzB,qBAAqB,CAAC,KAAD,CAArB,CACAZ,KAAK,CAACoC,WAAN,cAAApC,KAAK,CAACoC,WAAN,CAAoBC,MAApB,EACD,CAJ2D,CAA9D,CAOA,GAAMC,UAAiD,CAAG,GAAAZ,oCAAA,EACxD,SAACW,MAAD,CAAY,CACVzB,qBAAqB,CAAC,IAAD,CAArB,CACAZ,KAAK,CAACsC,SAAN,cAAAtC,KAAK,CAACsC,SAAN,CAAkBD,MAAlB,EACD,CAJuD,CAA1D,CAOA,GAAME,cAAyD,CAAG,GAAAb,oCAAA,EAChE,SAACW,MAAD,CAAY,CACVjB,kBAAkB,CAACiB,MAAM,CAAChB,WAAR,CAAlB,CACAJ,WAAW,kBACNoB,MADM,EAEThB,WAAW,CAAXA,WAFS,GAAX,CAIArB,KAAK,CAACuC,aAAN,cAAAvC,KAAK,CAACuC,aAAN,CAAsBF,MAAtB,EACD,CAR+D,CAAlE,CAWA,MACE,8BAAC,0BAAD,wBACE,GAAG,CAAEpC,GADP,CAEE,iBAAiB,CAAEwB,qBAFrB,CAGE,kBAAkB,CAAEzB,KAAK,CAACwC,kBAAN,EAA4B,EAHlD,CAIE,aAAa,CAAE,KAJjB,EAKMxC,KALN,EAME,iBAAiB,CAAEW,iBANrB,CAOE,WAAW,CAAEyB,WAPf,CAQE,SAAS,CAAEE,SARb,CASE,aAAa,CAAEC,aATjB,6EADF,CAaD,CAIM,GAAME,0BAAyB,CAAGC,cAAA,CAAMC,UAAN,CACvC5C,8BADuC,CAAlC,C"}